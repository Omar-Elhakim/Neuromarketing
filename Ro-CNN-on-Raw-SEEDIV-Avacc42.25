{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/rozero000/cnn-based-emotion-classification-on-seed-iv-8365c6?scriptVersionId=283822471\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"8e91eab1","metadata":{"execution":{"iopub.execute_input":"2025-12-04T09:49:27.304875Z","iopub.status.busy":"2025-12-04T09:49:27.304119Z","iopub.status.idle":"2025-12-04T09:49:27.310339Z","shell.execute_reply":"2025-12-04T09:49:27.309773Z"},"papermill":{"duration":0.012292,"end_time":"2025-12-04T09:49:27.311455","exception":false,"start_time":"2025-12-04T09:49:27.299163","status":"completed"},"tags":[]},"outputs":[],"source":["import os\n","os.environ[\"PYTORCH_CUDA_ALLOC_CONF\"] = \"expandable_segments:True\""]},{"cell_type":"code","execution_count":2,"id":"d1fb6886","metadata":{"execution":{"iopub.execute_input":"2025-12-04T09:49:27.318292Z","iopub.status.busy":"2025-12-04T09:49:27.317792Z","iopub.status.idle":"2025-12-04T10:03:10.530888Z","shell.execute_reply":"2025-12-04T10:03:10.530131Z"},"papermill":{"duration":823.217964,"end_time":"2025-12-04T10:03:10.532266","exception":false,"start_time":"2025-12-04T09:49:27.314302","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["\u001b[2K     \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m108.0/108.0 kB\u001b[0m \u001b[31m3.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\r\n","\u001b[2K     \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m251.4/251.4 kB\u001b[0m \u001b[31m12.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\r\n","\u001b[2K     \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m63.7/63.7 kB\u001b[0m \u001b[31m4.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K     \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m58.9/58.9 kB\u001b[0m \u001b[31m3.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K     \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m231.5/231.5 kB\u001b[0m \u001b[31m15.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m1.3/1.3 MB\u001b[0m \u001b[31m44.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m295.1/295.1 kB\u001b[0m \u001b[31m20.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m7.4/7.4 MB\u001b[0m \u001b[31m111.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m115.2/115.2 kB\u001b[0m \u001b[31m8.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m34.1/34.1 MB\u001b[0m \u001b[31m60.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m160.0/160.0 kB\u001b[0m \u001b[31m14.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m9.5/9.5 MB\u001b[0m \u001b[31m131.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m363.4/363.4 MB\u001b[0m \u001b[31m5.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m13.8/13.8 MB\u001b[0m \u001b[31m121.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m24.6/24.6 MB\u001b[0m \u001b[31m92.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m883.7/883.7 kB\u001b[0m \u001b[31m48.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m664.8/664.8 MB\u001b[0m \u001b[31m2.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m211.5/211.5 MB\u001b[0m \u001b[31m8.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m56.3/56.3 MB\u001b[0m \u001b[31m35.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m127.9/127.9 MB\u001b[0m \u001b[31m14.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m207.5/207.5 MB\u001b[0m \u001b[31m6.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m21.1/21.1 MB\u001b[0m \u001b[31m99.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m57.0/57.0 kB\u001b[0m \u001b[31m3.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m750.2/750.2 kB\u001b[0m \u001b[31m41.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[2K   \u001b[90m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\u001b[0m \u001b[32m1.7/1.7 MB\u001b[0m \u001b[31m76.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[?25h  Building wheel for torch_scatter (setup.py) ... \u001b[?25l\u001b[?25hdone\r\n","  Building wheel for torcheeg (setup.py) ... \u001b[?25l\u001b[?25hdone\r\n","  Building wheel for spectrum (setup.py) ... \u001b[?25l\u001b[?25hdone\r\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\r\n","kaggle-environments 1.18.0 requires scipy>=1.11.2, but you have scipy 1.10.1 which is incompatible.\r\n","cesium 0.12.4 requires numpy<3.0,>=2.0, but you have numpy 1.26.4 which is incompatible.\r\n","jax 0.5.2 requires scipy>=1.11.1, but you have scipy 1.10.1 which is incompatible.\r\n","tsfresh 0.21.0 requires scipy>=1.14.0; python_version >= \"3.10\", but you have scipy 1.10.1 which is incompatible.\r\n","dopamine-rl 4.1.2 requires gymnasium>=1.0.0, but you have gymnasium 0.29.0 which is incompatible.\r\n","scikit-image 0.25.2 requires scipy>=1.11.4, but you have scipy 1.10.1 which is incompatible.\r\n","libcugraph-cu12 25.6.0 requires libraft-cu12==25.6.*, but you have libraft-cu12 25.2.0 which is incompatible.\r\n","cvxpy 1.6.7 requires scipy>=1.11.0, but you have scipy 1.10.1 which is incompatible.\r\n","imbalanced-learn 0.13.0 requires scikit-learn<2,>=1.3.2, but you have scikit-learn 1.2.2 which is incompatible.\r\n","xarray-einstats 0.9.1 requires scipy>=1.11, but you have scipy 1.10.1 which is incompatible.\r\n","plotnine 0.14.5 requires matplotlib>=3.8.0, but you have matplotlib 3.7.2 which is incompatible.\r\n","pylibcugraph-cu12 25.6.0 requires pylibraft-cu12==25.6.*, but you have pylibraft-cu12 25.2.0 which is incompatible.\r\n","pylibcugraph-cu12 25.6.0 requires rmm-cu12==25.6.*, but you have rmm-cu12 25.2.0 which is incompatible.\r\n","jaxlib 0.5.1 requires scipy>=1.11.1, but you have scipy 1.10.1 which is incompatible.\r\n","umap-learn 0.5.9.post2 requires scikit-learn>=1.6, but you have scikit-learn 1.2.2 which is incompatible.\r\n","mlxtend 0.23.4 requires scikit-learn>=1.3.1, but you have scikit-learn 1.2.2 which is incompatible.\u001b[0m\u001b[31m\r\n","\u001b[0m"]}],"source":["!pip install torch_scatter torcheeg torch_geometric -qq "]},{"cell_type":"code","execution_count":3,"id":"f81dde3f","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:03:10.567884Z","iopub.status.busy":"2025-12-04T10:03:10.567637Z","iopub.status.idle":"2025-12-04T10:03:10.571009Z","shell.execute_reply":"2025-12-04T10:03:10.570535Z"},"papermill":{"duration":0.022038,"end_time":"2025-12-04T10:03:10.571987","exception":false,"start_time":"2025-12-04T10:03:10.549949","status":"completed"},"tags":[]},"outputs":[],"source":["#!rm -rf tmp_out"]},{"cell_type":"code","execution_count":4,"id":"fc7e0683","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:03:10.606953Z","iopub.status.busy":"2025-12-04T10:03:10.606755Z","iopub.status.idle":"2025-12-04T10:03:16.816152Z","shell.execute_reply":"2025-12-04T10:03:16.81539Z"},"papermill":{"duration":6.228844,"end_time":"2025-12-04T10:03:16.817615","exception":false,"start_time":"2025-12-04T10:03:10.588771","status":"completed"},"tags":[]},"outputs":[],"source":["import torch\n","import torch.nn as nn\n","import torch.optim as optim\n","from torch.utils.data import DataLoader, Subset, Dataset, WeightedRandomSampler\n","from torcheeg.datasets import SEEDIVDataset\n","from torcheeg import transforms\n","import scipy.signal as signal\n","import numpy as np\n","import random\n","import pandas as pd\n","from sklearn.model_selection import KFold\n","from sklearn.metrics import accuracy_score\n","import copy"]},{"cell_type":"code","execution_count":5,"id":"96753c8a","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:03:16.852562Z","iopub.status.busy":"2025-12-04T10:03:16.852107Z","iopub.status.idle":"2025-12-04T10:03:16.880181Z","shell.execute_reply":"2025-12-04T10:03:16.879446Z"},"papermill":{"duration":0.046499,"end_time":"2025-12-04T10:03:16.88125","exception":false,"start_time":"2025-12-04T10:03:16.834751","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Using device: cuda\n"]}],"source":["# Set device to GPU if available, otherwise CPU\n","device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')\n","print(f\"Using device: {device}\")"]},{"cell_type":"code","execution_count":6,"id":"95c9fec3","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:03:16.915257Z","iopub.status.busy":"2025-12-04T10:03:16.915066Z","iopub.status.idle":"2025-12-04T10:03:16.92276Z","shell.execute_reply":"2025-12-04T10:03:16.922259Z"},"papermill":{"duration":0.025845,"end_time":"2025-12-04T10:03:16.923825","exception":false,"start_time":"2025-12-04T10:03:16.89798","status":"completed"},"tags":[]},"outputs":[],"source":["# Set a fixed random seed for reproducibility across different libraries.\n","def set_seed(seed_value=42):\n","    random.seed(seed_value)\n","    np.random.seed(seed_value)\n","    torch.manual_seed(seed_value)\n","    if torch.cuda.is_available():\n","        torch.cuda.manual_seed_all(seed_value)\n","set_seed(42)"]},{"cell_type":"code","execution_count":7,"id":"2657edab","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:03:16.957695Z","iopub.status.busy":"2025-12-04T10:03:16.95751Z","iopub.status.idle":"2025-12-04T10:03:16.960906Z","shell.execute_reply":"2025-12-04T10:03:16.960398Z"},"papermill":{"duration":0.021408,"end_time":"2025-12-04T10:03:16.961898","exception":false,"start_time":"2025-12-04T10:03:16.94049","status":"completed"},"tags":[]},"outputs":[],"source":["def BandPassFilter(eeg_data):\n","    b, a = signal.butter(4, Wn=[1.0, 75.0], btype='bandpass', fs=200)\n","    return signal.filtfilt(b, a, eeg_data, axis=-1)"]},{"cell_type":"code","execution_count":8,"id":"b01f9448","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:03:16.995653Z","iopub.status.busy":"2025-12-04T10:03:16.995448Z","iopub.status.idle":"2025-12-04T10:03:16.999017Z","shell.execute_reply":"2025-12-04T10:03:16.998344Z"},"papermill":{"duration":0.021715,"end_time":"2025-12-04T10:03:16.999999","exception":false,"start_time":"2025-12-04T10:03:16.978284","status":"completed"},"tags":[]},"outputs":[],"source":["def Notch(eeg_data):\n","    b, a = signal.iirnotch(w0=50.0, Q=30.0, fs=200)\n","    return signal.filtfilt(b, a, eeg_data, axis=-1)"]},{"cell_type":"code","execution_count":9,"id":"f45b8bb6","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:03:17.033851Z","iopub.status.busy":"2025-12-04T10:03:17.033471Z","iopub.status.idle":"2025-12-04T10:03:17.036861Z","shell.execute_reply":"2025-12-04T10:03:17.036187Z"},"papermill":{"duration":0.021386,"end_time":"2025-12-04T10:03:17.037888","exception":false,"start_time":"2025-12-04T10:03:17.016502","status":"completed"},"tags":[]},"outputs":[],"source":["# 2. Define Preprocessing\n","t_transform = transforms.Compose([\n","    transforms.Lambda(BandPassFilter),\n","    transforms.Lambda(Notch),\n","    transforms.BaselineRemoval(),\n","    transforms.MeanStdNormalize(),\n","    transforms.To2d()\n","    \n","])"]},{"cell_type":"code","execution_count":10,"id":"7cddb2d0","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:03:17.071891Z","iopub.status.busy":"2025-12-04T10:03:17.071691Z","iopub.status.idle":"2025-12-04T10:12:18.403865Z","shell.execute_reply":"2025-12-04T10:12:18.403087Z"},"papermill":{"duration":541.350675,"end_time":"2025-12-04T10:12:18.405321","exception":false,"start_time":"2025-12-04T10:03:17.054646","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["[2025-12-04 10:03:17] INFO (torcheeg/MainThread) üîç | Processing EEG data. Processed EEG data has been cached to \u001b[92m./tmp_out/seed_iv\u001b[0m.\n","[2025-12-04 10:03:17] INFO (torcheeg/MainThread) ‚è≥ | Monitoring the detailed processing of a record for debugging. The processing of other records will only be reported in percentage to keep it clean.\n","[PROCESS]:   0%|          | 0/45 [00:00<?, ?it/s]\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 0it [00:00, ?it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 1it [00:03,  3.90s/it]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 10it [00:03,  3.43it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 20it [00:04,  8.06it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 30it [00:04, 13.90it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 40it [00:04, 21.10it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 50it [00:04, 29.44it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 60it [00:04, 38.39it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 70it [00:04, 47.60it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 80it [00:04, 56.07it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 90it [00:04, 64.24it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 100it [00:04, 71.67it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 110it [00:05, 76.90it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 120it [00:05, 81.42it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 130it [00:05, 85.72it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 140it [00:05, 89.19it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 150it [00:05, 89.86it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 160it [00:05, 91.10it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 170it [00:05, 90.81it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 180it [00:05, 91.16it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 190it [00:05, 92.29it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 200it [00:06, 92.33it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 210it [00:06, 92.96it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 220it [00:06, 93.75it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 230it [00:06, 93.33it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 240it [00:06, 94.78it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 250it [00:06, 94.67it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 260it [00:06, 93.07it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 270it [00:06, 91.83it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 280it [00:06, 90.91it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 290it [00:06, 91.86it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 300it [00:07, 92.05it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 310it [00:07, 91.98it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 320it [00:07, 91.83it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 330it [00:07, 90.20it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 340it [00:07, 89.90it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 349it [00:07, 89.80it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 359it [00:07, 90.55it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 369it [00:07, 90.88it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 379it [00:07, 91.12it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 389it [00:08, 91.89it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 399it [00:08, 92.08it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 409it [00:08, 92.30it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 419it [00:08, 92.29it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 429it [00:08, 92.39it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 439it [00:08, 93.05it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 449it [00:08, 93.61it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 459it [00:08, 93.85it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 469it [00:08, 94.02it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 479it [00:09, 93.79it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 489it [00:09, 93.05it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 499it [00:09, 93.32it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 509it [00:09, 92.63it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 519it [00:09, 93.53it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 529it [00:09, 94.92it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 539it [00:09, 95.16it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 549it [00:09, 96.12it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 559it [00:09, 97.13it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 569it [00:09, 96.71it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 579it [00:10, 96.18it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 589it [00:10, 95.07it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 599it [00:10, 94.86it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 609it [00:10, 93.79it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 619it [00:10, 93.93it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 629it [00:10, 94.14it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 639it [00:10, 94.41it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 649it [00:10, 94.23it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 659it [00:10, 94.95it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 669it [00:11, 95.33it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 679it [00:11, 96.11it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 689it [00:11, 95.41it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 699it [00:11, 95.93it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 710it [00:11, 97.28it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 720it [00:11, 97.15it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 730it [00:11, 97.13it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 740it [00:11, 96.55it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 750it [00:11, 96.03it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 760it [00:11, 95.39it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 770it [00:12, 90.41it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 780it [00:12, 91.00it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 790it [00:12, 92.82it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 800it [00:12, 93.65it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 810it [00:12, 94.24it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 820it [00:12, 95.02it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 830it [00:12, 94.57it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 840it [00:12, 94.21it/s]\u001b[A\n","[RECORD /kaggle/input/seed-iv/eeg_raw_data/1/4_20151111.mat]: 850it [00:12, 94.58it/s]\u001b[A\n","[PROCESS]: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 45/45 [09:01<00:00, 12.03s/it]\n","[2025-12-04 10:12:18] INFO (torcheeg/MainThread) ‚úÖ | All processed EEG data has been cached to ./tmp_out/seed_iv.\n","[2025-12-04 10:12:18] INFO (torcheeg/MainThread) üòä | Please set \u001b[92mio_path\u001b[0m to \u001b[92m./tmp_out/seed_iv\u001b[0m for the next run, to directly read from the cache if you wish to skip the data processing step.\n"]}],"source":["dataset = SEEDIVDataset(\n","    io_path='./tmp_out/seed_iv',\n","    root_path='/kaggle/input/seed-iv/eeg_raw_data',\n","    offline_transform=t_transform,\n","    label_transform=transforms.Select('emotion'),\n","    chunk_size=800,  # 4 seconds\n","    num_worker=0\n",")"]},{"cell_type":"code","execution_count":11,"id":"2ba96a8c","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:12:18.464838Z","iopub.status.busy":"2025-12-04T10:12:18.464611Z","iopub.status.idle":"2025-12-04T10:12:18.47861Z","shell.execute_reply":"2025-12-04T10:12:18.477853Z"},"papermill":{"duration":0.045275,"end_time":"2025-12-04T10:12:18.479686","exception":false,"start_time":"2025-12-04T10:12:18.434411","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Class Counts:\n"," emotion\n","0    10170\n","1    10245\n","2     9225\n","3     7935\n","Name: count, dtype: int64\n"]}],"source":["df = dataset.info\n","counts = df['emotion'].value_counts().sort_index()\n","print(\"Class Counts:\\n\", counts)"]},{"cell_type":"code","execution_count":12,"id":"ac91f466","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:12:18.537892Z","iopub.status.busy":"2025-12-04T10:12:18.537514Z","iopub.status.idle":"2025-12-04T10:12:18.541029Z","shell.execute_reply":"2025-12-04T10:12:18.540402Z"},"papermill":{"duration":0.03417,"end_time":"2025-12-04T10:12:18.542101","exception":false,"start_time":"2025-12-04T10:12:18.507931","status":"completed"},"tags":[]},"outputs":[],"source":["BATCH_SIZE = 16               \n","MAX_EPOCHS = 60\n","PATIENCE = 10                 \n","SCHED_FACTOR = 0.3\n","SCHED_PATIENCE = 3\n","LEARNING_RATE = 3e-4\n","WEIGHT_DECAY = 1e-4\n","CLIP_GRAD = 1.0  \n","N_SPLITS = 5 "]},{"cell_type":"code","execution_count":13,"id":"00d98cea","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:12:18.599709Z","iopub.status.busy":"2025-12-04T10:12:18.599512Z","iopub.status.idle":"2025-12-04T10:12:18.609396Z","shell.execute_reply":"2025-12-04T10:12:18.608722Z"},"papermill":{"duration":0.040262,"end_time":"2025-12-04T10:12:18.610413","exception":false,"start_time":"2025-12-04T10:12:18.570151","status":"completed"},"tags":[]},"outputs":[],"source":["class EEG_CNN(nn.Module):\n","\n","    def __init__(self, in_channels=1, num_classes=4):\n","        super().__init__()\n","\n","        self.print_dims = True\n","\n","        # ----- Block 1 -----\n","        self.conv1 = nn.Sequential(\n","            nn.Conv2d(in_channels, 32, kernel_size=(1,9), padding=(0,4)),\n","            nn.BatchNorm2d(32),\n","            nn.ReLU(),\n","            nn.MaxPool2d((1,2)),\n","            nn.Dropout(0.1)\n","        )\n","\n","        # ----- Block 2 -----\n","        self.conv2 = nn.Sequential(\n","            nn.Conv2d(32, 64, kernel_size=(1,7), padding=(0,3)),\n","            nn.BatchNorm2d(64),\n","            nn.ReLU(),\n","            nn.MaxPool2d((1,2)),\n","            nn.Dropout(0.15)\n","        )\n","\n","        # ----- Block 3 -----\n","        self.conv3 = nn.Sequential(\n","            nn.Conv2d(64, 128, kernel_size=(1,5), padding=(0,1)),\n","            nn.BatchNorm2d(128),\n","            nn.ReLU(),\n","            nn.MaxPool2d((1,2)),\n","            nn.Dropout(0.2)\n","        )\n","\n","        # ----- Block 4 -----\n","        self.conv4 = nn.Sequential(\n","            nn.Conv2d(128, 256, kernel_size=(1,3), padding=(0,1)),\n","            nn.BatchNorm2d(256),\n","            nn.ReLU(),\n","            nn.MaxPool2d((1,2)),\n","            nn.Dropout(0.25)\n","        )\n","\n","        self.conv5 = nn.Sequential(\n","            nn.Conv2d(256, 512, kernel_size=(1,3), padding=(0,1)),\n","            nn.BatchNorm2d(512),\n","            nn.ReLU(),\n","            nn.MaxPool2d((1,2)),\n","            nn.Dropout(0.3)\n","        )\n","\n","        #self.flatten = nn.Flatten()\n","        # Global pooling instead of flatten (saves memory)\n","        self.gap = nn.AdaptiveAvgPool2d((1,1))  \n","\n","        # ----- FC Layers -----\n","        self.fc = nn.Sequential(\n","            nn.Flatten(),  \n","            nn.LazyLinear(256),\n","            nn.ReLU(),\n","            nn.Dropout(0.4),\n","\n","            nn.Linear(256, num_classes)\n","        )\n","\n","\n","    def forward(self, x):\n","\n","        if self.print_dims: print(\"Input : H =\", x.shape[2], \"W =\", x.shape[3])\n","\n","        x = self.conv1(x)\n","        if self.print_dims: print(\"After Conv1 :H =\", x.shape[2], \"W =\", x.shape[3])\n","\n","        x = self.conv2(x)\n","        if self.print_dims: print(\"After Conv2 :H =\", x.shape[2], \"W =\", x.shape[3])\n","\n","        x = self.conv3(x)\n","        if self.print_dims: print(\"After Conv3 :H =\", x.shape[2], \"W =\", x.shape[3])\n","\n","        x = self.conv4(x)\n","        if self.print_dims: print(\"After Conv4 :H =\", x.shape[2], \"W =\", x.shape[3])\n","\n","        x = self.conv5(x)\n","        if self.print_dims: print(\"After Conv5 :H =\", x.shape[2], \"W =\", x.shape[3])\n","\n","        x = self.gap(x) \n","        if self.print_dims:\n","            print(\"After Flatten :\", x.shape)\n","            self.print_dims = False\n","\n","        x = self.fc(x)\n","        return x\n"]},{"cell_type":"code","execution_count":14,"id":"cb1d1644","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:12:18.667852Z","iopub.status.busy":"2025-12-04T10:12:18.667489Z","iopub.status.idle":"2025-12-04T10:12:18.673192Z","shell.execute_reply":"2025-12-04T10:12:18.67254Z"},"papermill":{"duration":0.035658,"end_time":"2025-12-04T10:12:18.674235","exception":false,"start_time":"2025-12-04T10:12:18.638577","status":"completed"},"tags":[]},"outputs":[],"source":["#scaler = torch.cuda.amp.GradScaler(enabled=(device.type == 'cuda'))\n","#scaler = torch.amp.GradScaler(device=\"cuda\", enabled=True)\n","scaler = torch.amp.GradScaler(device.type if device.type == 'cuda' else 'cpu')\n","\n","\n","def train_epoch(model, loader, criterion, optimizer, clip_grad=None):\n","    model.train()\n","    loss_sum = 0.0\n","    correct = 0\n","    total = 0\n","\n","    for X, y in loader:\n","        X = X.to(device).float()\n","        y = y.to(device).long()\n","\n","        optimizer.zero_grad()\n","        #with torch.cuda.amp.autocast(enabled=(device.type == 'cuda')):\n","        with torch.amp.autocast(device.type if device.type == 'cuda' else 'cpu'):\n","            out = model(X)\n","            loss = criterion(out, y)\n","\n","        scaler.scale(loss).backward()\n","\n","        if clip_grad:\n","            # unscale then clip\n","            scaler.unscale_(optimizer)\n","            nn.utils.clip_grad_norm_(model.parameters(), clip_grad)\n","\n","        scaler.step(optimizer)\n","        scaler.update()\n","\n","        batch = y.size(0)\n","        loss_sum += loss.item() * batch\n","        correct += (out.argmax(1) == y).sum().item()\n","        total += batch\n","\n","    return loss_sum / total, 100.0 * correct / total\n"]},{"cell_type":"code","execution_count":15,"id":"72a837b8","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:12:18.731577Z","iopub.status.busy":"2025-12-04T10:12:18.730995Z","iopub.status.idle":"2025-12-04T10:12:18.735587Z","shell.execute_reply":"2025-12-04T10:12:18.735062Z"},"papermill":{"duration":0.034414,"end_time":"2025-12-04T10:12:18.736633","exception":false,"start_time":"2025-12-04T10:12:18.702219","status":"completed"},"tags":[]},"outputs":[],"source":["def evaluate(model, loader, criterion):\n","    model.eval()\n","    loss_sum = 0.0\n","    correct = 0\n","    total = 0\n","\n","    with torch.no_grad():\n","        for X, y in loader:\n","            X = X.to(device).float()\n","            y = y.to(device).long()\n","            with torch.cuda.amp.autocast(enabled=(device.type == 'cuda')):\n","                out = model(X)\n","                loss = criterion(out, y)\n","\n","            batch = y.size(0)\n","            loss_sum += loss.item() * batch\n","            correct += (out.argmax(1) == y).sum().item()\n","            total += batch\n","\n","    return loss_sum / total, 100.0 * correct / total"]},{"cell_type":"code","execution_count":16,"id":"922f8ecf","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:12:18.793992Z","iopub.status.busy":"2025-12-04T10:12:18.793559Z","iopub.status.idle":"2025-12-04T10:12:18.798516Z","shell.execute_reply":"2025-12-04T10:12:18.797842Z"},"papermill":{"duration":0.03505,"end_time":"2025-12-04T10:12:18.799612","exception":false,"start_time":"2025-12-04T10:12:18.764562","status":"completed"},"tags":[]},"outputs":[],"source":["def train_with_early_stopping(model, train_loader, val_loader, criterion, optimizer, scheduler,\n","                              max_epochs=MAX_EPOCHS, patience=PATIENCE, clip_grad=CLIP_GRAD):\n","    best_acc = 0.0\n","    best_state = None\n","    counter = 0\n","\n","    for epoch in range(max_epochs):\n","        train_loss, train_acc = train_epoch(model, train_loader, criterion, optimizer, clip_grad=clip_grad)\n","        val_loss, val_acc = evaluate(model, val_loader, criterion)\n","\n","        scheduler.step(val_loss)\n","\n","        print(f\"Epoch {epoch+1:02d} | Train={train_acc:.2f}% | Val={val_acc:.2f}% | ValLoss={val_loss:.4f}\")\n","\n","        if val_acc > best_acc + 1e-4:   # small delta to avoid noise\n","            best_acc = val_acc\n","            best_state = copy.deepcopy(model.state_dict())\n","            counter = 0\n","        else:\n","            counter += 1\n","            if counter >= patience:\n","                print(f\"Early stopping (no improvement for {patience} epochs).\")\n","                break\n","\n","    return best_acc, best_state\n"]},{"cell_type":"code","execution_count":17,"id":"42ce7cf7","metadata":{"execution":{"iopub.execute_input":"2025-12-04T10:12:18.856069Z","iopub.status.busy":"2025-12-04T10:12:18.85587Z","iopub.status.idle":"2025-12-04T18:50:39.922758Z","shell.execute_reply":"2025-12-04T18:50:39.921934Z"},"papermill":{"duration":31101.132653,"end_time":"2025-12-04T18:50:39.96012","exception":false,"start_time":"2025-12-04T10:12:18.827467","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["\n","========== Starting Cross‚ÄëValidation ==========\n","\n","\n","----- Fold 1 -----\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.11/dist-packages/torch/optim/lr_scheduler.py:62: UserWarning: The verbose parameter is deprecated. Please use get_last_lr() to access the learning rate.\n","  warnings.warn(\n"]},{"name":"stdout","output_type":"stream","text":["Input : H = 62 W = 800\n","After Conv1 :H = 62 W = 400\n","After Conv2 :H = 62 W = 200\n","After Conv3 :H = 62 W = 99\n","After Conv4 :H = 62 W = 49\n","After Conv5 :H = 62 W = 24\n","After Flatten : torch.Size([16, 512, 1, 1])\n"]},{"name":"stderr","output_type":"stream","text":["/tmp/ipykernel_20/1341851955.py:11: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.\n","  with torch.cuda.amp.autocast(enabled=(device.type == 'cuda')):\n"]},{"name":"stdout","output_type":"stream","text":["Epoch 01 | Train=28.96% | Val=26.60% | ValLoss=1.3837\n","Epoch 02 | Train=30.65% | Val=29.61% | ValLoss=1.3685\n","Epoch 03 | Train=30.94% | Val=32.16% | ValLoss=1.3544\n","Epoch 04 | Train=31.74% | Val=29.34% | ValLoss=1.3678\n","Epoch 05 | Train=32.71% | Val=29.42% | ValLoss=1.3609\n","Epoch 06 | Train=33.71% | Val=30.94% | ValLoss=1.3580\n","Epoch 07 | Train=34.30% | Val=27.11% | ValLoss=1.4055\n","Epoch 08 | Train=35.89% | Val=34.93% | ValLoss=1.3296\n","Epoch 09 | Train=36.71% | Val=36.65% | ValLoss=1.3166\n","Epoch 10 | Train=37.20% | Val=37.38% | ValLoss=1.3197\n","Epoch 11 | Train=38.19% | Val=38.35% | ValLoss=1.3036\n","Epoch 12 | Train=38.73% | Val=36.86% | ValLoss=1.3330\n","Epoch 13 | Train=39.25% | Val=37.83% | ValLoss=1.3057\n","Epoch 14 | Train=39.92% | Val=39.61% | ValLoss=1.2936\n","Epoch 15 | Train=40.28% | Val=38.16% | ValLoss=1.3202\n","Epoch 16 | Train=40.78% | Val=32.69% | ValLoss=1.3889\n","Epoch 17 | Train=40.84% | Val=38.20% | ValLoss=1.3212\n","Epoch 18 | Train=41.26% | Val=36.03% | ValLoss=1.3474\n","Epoch 19 | Train=42.39% | Val=41.70% | ValLoss=1.2753\n","Epoch 20 | Train=42.84% | Val=40.90% | ValLoss=1.2915\n","Epoch 21 | Train=43.10% | Val=41.57% | ValLoss=1.2791\n","Epoch 22 | Train=42.50% | Val=40.72% | ValLoss=1.2814\n","Epoch 23 | Train=42.82% | Val=41.14% | ValLoss=1.2851\n","Epoch 24 | Train=43.67% | Val=41.42% | ValLoss=1.2797\n","Epoch 25 | Train=43.66% | Val=41.61% | ValLoss=1.2763\n","Epoch 26 | Train=43.43% | Val=41.32% | ValLoss=1.2779\n","Epoch 27 | Train=43.64% | Val=41.40% | ValLoss=1.2778\n","Epoch 28 | Train=44.36% | Val=41.44% | ValLoss=1.2734\n","Epoch 29 | Train=43.90% | Val=41.60% | ValLoss=1.2765\n","Early stopping (no improvement for 10 epochs).\n","Best Accuracy (Fold 1): 41.70%\n","\n","----- Fold 2 -----\n","Input : H = 62 W = 800\n","After Conv1 :H = 62 W = 400\n","After Conv2 :H = 62 W = 200\n","After Conv3 :H = 62 W = 99\n","After Conv4 :H = 62 W = 49\n","After Conv5 :H = 62 W = 24\n","After Flatten : torch.Size([16, 512, 1, 1])\n","Epoch 01 | Train=28.26% | Val=28.68% | ValLoss=1.3715\n","Epoch 02 | Train=29.59% | Val=29.78% | ValLoss=1.3646\n","Epoch 03 | Train=30.66% | Val=31.47% | ValLoss=1.3683\n","Epoch 04 | Train=32.63% | Val=31.80% | ValLoss=1.3496\n","Epoch 05 | Train=33.03% | Val=34.21% | ValLoss=1.3407\n","Epoch 06 | Train=34.54% | Val=33.21% | ValLoss=1.3586\n","Epoch 07 | Train=34.54% | Val=33.17% | ValLoss=1.3550\n","Epoch 08 | Train=36.09% | Val=34.65% | ValLoss=1.3312\n","Epoch 09 | Train=36.74% | Val=36.18% | ValLoss=1.3169\n","Epoch 10 | Train=36.92% | Val=35.93% | ValLoss=1.3251\n","Epoch 11 | Train=37.95% | Val=39.12% | ValLoss=1.3088\n","Epoch 12 | Train=38.40% | Val=38.88% | ValLoss=1.3009\n","Epoch 13 | Train=39.10% | Val=38.38% | ValLoss=1.2950\n","Epoch 14 | Train=39.57% | Val=36.93% | ValLoss=1.3281\n","Epoch 15 | Train=40.37% | Val=38.23% | ValLoss=1.3017\n","Epoch 16 | Train=39.91% | Val=38.90% | ValLoss=1.2992\n","Epoch 17 | Train=40.83% | Val=40.73% | ValLoss=1.2835\n","Epoch 18 | Train=41.31% | Val=40.37% | ValLoss=1.2847\n","Epoch 19 | Train=41.77% | Val=39.81% | ValLoss=1.3055\n","Epoch 20 | Train=41.82% | Val=37.72% | ValLoss=1.3197\n","Epoch 21 | Train=42.18% | Val=36.35% | ValLoss=1.3591\n","Epoch 22 | Train=44.23% | Val=39.00% | ValLoss=1.3427\n","Epoch 23 | Train=44.85% | Val=42.25% | ValLoss=1.2618\n","Epoch 24 | Train=45.04% | Val=42.20% | ValLoss=1.2689\n","Epoch 25 | Train=44.89% | Val=39.12% | ValLoss=1.3415\n","Epoch 26 | Train=45.68% | Val=42.65% | ValLoss=1.2531\n","Epoch 27 | Train=45.60% | Val=41.82% | ValLoss=1.2920\n","Epoch 28 | Train=46.25% | Val=41.94% | ValLoss=1.2919\n","Epoch 29 | Train=46.62% | Val=42.22% | ValLoss=1.2790\n","Epoch 30 | Train=47.03% | Val=42.34% | ValLoss=1.2655\n","Epoch 31 | Train=47.74% | Val=41.69% | ValLoss=1.2939\n","Epoch 32 | Train=47.63% | Val=42.38% | ValLoss=1.2822\n","Epoch 33 | Train=48.09% | Val=41.86% | ValLoss=1.3048\n","Epoch 34 | Train=47.94% | Val=42.33% | ValLoss=1.2949\n","Epoch 35 | Train=48.12% | Val=42.16% | ValLoss=1.2899\n","Epoch 36 | Train=48.07% | Val=42.41% | ValLoss=1.2910\n","Early stopping (no improvement for 10 epochs).\n","Best Accuracy (Fold 2): 42.65%\n","\n","----- Fold 3 -----\n","Input : H = 62 W = 800\n","After Conv1 :H = 62 W = 400\n","After Conv2 :H = 62 W = 200\n","After Conv3 :H = 62 W = 99\n","After Conv4 :H = 62 W = 49\n","After Conv5 :H = 62 W = 24\n","After Flatten : torch.Size([16, 512, 1, 1])\n","Epoch 01 | Train=27.30% | Val=29.25% | ValLoss=1.3733\n","Epoch 02 | Train=29.78% | Val=26.00% | ValLoss=1.3905\n","Epoch 03 | Train=31.00% | Val=27.48% | ValLoss=1.4009\n","Epoch 04 | Train=32.04% | Val=33.47% | ValLoss=1.3493\n","Epoch 05 | Train=33.14% | Val=31.32% | ValLoss=1.3829\n","Epoch 06 | Train=33.24% | Val=32.34% | ValLoss=1.3487\n","Epoch 07 | Train=34.63% | Val=34.92% | ValLoss=1.3310\n","Epoch 08 | Train=35.08% | Val=35.44% | ValLoss=1.3258\n","Epoch 09 | Train=35.95% | Val=35.56% | ValLoss=1.3247\n","Epoch 10 | Train=37.24% | Val=36.82% | ValLoss=1.3158\n","Epoch 11 | Train=38.34% | Val=38.35% | ValLoss=1.3046\n","Epoch 12 | Train=38.87% | Val=39.24% | ValLoss=1.2976\n","Epoch 13 | Train=39.02% | Val=38.20% | ValLoss=1.3130\n","Epoch 14 | Train=39.88% | Val=35.83% | ValLoss=1.3189\n","Epoch 15 | Train=39.67% | Val=37.33% | ValLoss=1.3089\n","Epoch 16 | Train=39.86% | Val=38.43% | ValLoss=1.3520\n","Epoch 17 | Train=42.12% | Val=41.42% | ValLoss=1.2703\n","Epoch 18 | Train=42.92% | Val=41.74% | ValLoss=1.2796\n","Epoch 19 | Train=42.54% | Val=39.36% | ValLoss=1.3029\n","Epoch 20 | Train=43.48% | Val=41.52% | ValLoss=1.2969\n","Epoch 21 | Train=42.98% | Val=41.65% | ValLoss=1.2901\n","Epoch 22 | Train=43.89% | Val=42.29% | ValLoss=1.2663\n","Epoch 23 | Train=44.76% | Val=41.86% | ValLoss=1.2775\n","Epoch 24 | Train=45.34% | Val=42.41% | ValLoss=1.2837\n","Epoch 25 | Train=43.54% | Val=42.83% | ValLoss=1.2627\n","Epoch 26 | Train=45.06% | Val=41.96% | ValLoss=1.2921\n","Epoch 27 | Train=45.09% | Val=42.12% | ValLoss=1.2854\n","Epoch 28 | Train=44.79% | Val=41.72% | ValLoss=1.2841\n","Epoch 29 | Train=45.23% | Val=41.37% | ValLoss=1.2993\n","Epoch 30 | Train=45.63% | Val=41.80% | ValLoss=1.2952\n","Epoch 31 | Train=45.72% | Val=41.81% | ValLoss=1.2918\n","Epoch 32 | Train=45.36% | Val=41.25% | ValLoss=1.2959\n","Epoch 33 | Train=45.89% | Val=42.36% | ValLoss=1.2776\n","Epoch 34 | Train=45.33% | Val=41.41% | ValLoss=1.2944\n","Epoch 35 | Train=45.69% | Val=42.04% | ValLoss=1.2836\n","Early stopping (no improvement for 10 epochs).\n","Best Accuracy (Fold 3): 42.83%\n","\n","----- Fold 4 -----\n","Input : H = 62 W = 800\n","After Conv1 :H = 62 W = 400\n","After Conv2 :H = 62 W = 200\n","After Conv3 :H = 62 W = 99\n","After Conv4 :H = 62 W = 49\n","After Conv5 :H = 62 W = 24\n","After Flatten : torch.Size([16, 512, 1, 1])\n","Epoch 01 | Train=28.38% | Val=29.75% | ValLoss=1.3682\n","Epoch 02 | Train=29.70% | Val=29.77% | ValLoss=1.3640\n","Epoch 03 | Train=31.15% | Val=31.31% | ValLoss=1.3618\n","Epoch 04 | Train=32.17% | Val=32.75% | ValLoss=1.3505\n","Epoch 05 | Train=32.62% | Val=33.29% | ValLoss=1.3421\n","Epoch 06 | Train=33.76% | Val=33.60% | ValLoss=1.3325\n","Epoch 07 | Train=34.40% | Val=36.33% | ValLoss=1.3266\n","Epoch 08 | Train=35.30% | Val=35.64% | ValLoss=1.3275\n","Epoch 09 | Train=36.23% | Val=36.75% | ValLoss=1.3226\n","Epoch 10 | Train=36.80% | Val=36.90% | ValLoss=1.3118\n","Epoch 11 | Train=37.50% | Val=36.77% | ValLoss=1.3255\n","Epoch 12 | Train=38.45% | Val=38.92% | ValLoss=1.3051\n","Epoch 13 | Train=39.49% | Val=38.84% | ValLoss=1.3025\n","Epoch 14 | Train=39.62% | Val=36.74% | ValLoss=1.3362\n","Epoch 15 | Train=39.80% | Val=38.46% | ValLoss=1.3188\n","Epoch 16 | Train=40.35% | Val=39.33% | ValLoss=1.2983\n","Epoch 17 | Train=40.66% | Val=39.97% | ValLoss=1.2864\n","Epoch 18 | Train=41.01% | Val=40.23% | ValLoss=1.2879\n","Epoch 19 | Train=41.17% | Val=40.67% | ValLoss=1.2842\n","Epoch 20 | Train=41.46% | Val=39.56% | ValLoss=1.2934\n","Epoch 21 | Train=41.73% | Val=37.35% | ValLoss=1.3103\n","Epoch 22 | Train=42.46% | Val=40.17% | ValLoss=1.2827\n","Epoch 23 | Train=42.29% | Val=37.18% | ValLoss=1.3336\n","Epoch 24 | Train=43.58% | Val=39.53% | ValLoss=1.3005\n","Epoch 25 | Train=43.45% | Val=40.68% | ValLoss=1.2863\n","Epoch 26 | Train=43.22% | Val=40.36% | ValLoss=1.2910\n","Epoch 27 | Train=45.61% | Val=40.73% | ValLoss=1.3019\n","Epoch 28 | Train=46.46% | Val=42.51% | ValLoss=1.2647\n","Epoch 29 | Train=46.79% | Val=41.72% | ValLoss=1.2789\n","Epoch 30 | Train=46.79% | Val=41.97% | ValLoss=1.2701\n","Epoch 31 | Train=47.39% | Val=41.94% | ValLoss=1.2826\n","Epoch 32 | Train=47.72% | Val=40.90% | ValLoss=1.3184\n","Epoch 33 | Train=48.46% | Val=40.94% | ValLoss=1.2980\n","Epoch 34 | Train=49.06% | Val=40.45% | ValLoss=1.3088\n","Epoch 35 | Train=49.87% | Val=40.83% | ValLoss=1.3105\n","Epoch 36 | Train=49.11% | Val=39.83% | ValLoss=1.3288\n","Epoch 37 | Train=50.05% | Val=40.45% | ValLoss=1.3105\n","Epoch 38 | Train=50.20% | Val=41.36% | ValLoss=1.2973\n","Early stopping (no improvement for 10 epochs).\n","Best Accuracy (Fold 4): 42.51%\n","\n","----- Fold 5 -----\n","Input : H = 62 W = 800\n","After Conv1 :H = 62 W = 400\n","After Conv2 :H = 62 W = 200\n","After Conv3 :H = 62 W = 99\n","After Conv4 :H = 62 W = 49\n","After Conv5 :H = 62 W = 24\n","After Flatten : torch.Size([16, 512, 1, 1])\n","Epoch 01 | Train=28.98% | Val=27.97% | ValLoss=1.3796\n","Epoch 02 | Train=30.20% | Val=28.78% | ValLoss=1.3727\n","Epoch 03 | Train=31.45% | Val=30.55% | ValLoss=1.3614\n","Epoch 04 | Train=32.41% | Val=30.17% | ValLoss=1.3591\n","Epoch 05 | Train=33.07% | Val=32.38% | ValLoss=1.3467\n","Epoch 06 | Train=33.85% | Val=34.65% | ValLoss=1.3374\n","Epoch 07 | Train=35.10% | Val=33.25% | ValLoss=1.3470\n","Epoch 08 | Train=35.76% | Val=32.87% | ValLoss=1.3637\n","Epoch 09 | Train=37.00% | Val=32.73% | ValLoss=1.3679\n","Epoch 10 | Train=36.37% | Val=36.13% | ValLoss=1.3221\n","Epoch 11 | Train=37.34% | Val=35.14% | ValLoss=1.3343\n","Epoch 12 | Train=38.50% | Val=34.96% | ValLoss=1.3383\n","Epoch 13 | Train=38.87% | Val=37.46% | ValLoss=1.3106\n","Epoch 14 | Train=38.61% | Val=38.60% | ValLoss=1.3069\n","Epoch 15 | Train=39.58% | Val=38.18% | ValLoss=1.3130\n","Epoch 16 | Train=40.48% | Val=38.40% | ValLoss=1.3020\n","Epoch 17 | Train=40.68% | Val=37.26% | ValLoss=1.3256\n","Epoch 18 | Train=41.46% | Val=37.29% | ValLoss=1.3259\n","Epoch 19 | Train=41.40% | Val=39.11% | ValLoss=1.2938\n","Epoch 20 | Train=41.60% | Val=35.06% | ValLoss=1.4145\n","Epoch 21 | Train=41.88% | Val=37.29% | ValLoss=1.3620\n","Epoch 22 | Train=42.52% | Val=36.61% | ValLoss=1.3667\n","Epoch 23 | Train=42.54% | Val=37.15% | ValLoss=1.3418\n","Epoch 24 | Train=45.26% | Val=41.45% | ValLoss=1.2754\n","Epoch 25 | Train=45.94% | Val=41.82% | ValLoss=1.2693\n","Epoch 26 | Train=45.75% | Val=41.34% | ValLoss=1.2782\n","Epoch 27 | Train=45.89% | Val=41.28% | ValLoss=1.2820\n","Epoch 28 | Train=45.91% | Val=41.81% | ValLoss=1.2818\n","Epoch 29 | Train=46.59% | Val=40.48% | ValLoss=1.3076\n","Epoch 30 | Train=47.43% | Val=40.96% | ValLoss=1.2941\n","Epoch 31 | Train=47.96% | Val=41.44% | ValLoss=1.2862\n","Epoch 32 | Train=47.76% | Val=39.75% | ValLoss=1.3258\n","Epoch 33 | Train=48.45% | Val=41.25% | ValLoss=1.2903\n","Epoch 34 | Train=47.70% | Val=41.28% | ValLoss=1.2848\n","Epoch 35 | Train=48.18% | Val=40.86% | ValLoss=1.2939\n","Early stopping (no improvement for 10 epochs).\n","Best Accuracy (Fold 5): 41.82%\n","\n","========== Final Cross‚ÄëValidation Results ==========\n","Fold 1: 41.70%\n","Fold 2: 42.65%\n","Fold 3: 42.83%\n","Fold 4: 42.51%\n","Fold 5: 41.82%\n","\n","Average Accuracy = 42.30472388556221\n"]}],"source":["from torch.optim.lr_scheduler import ReduceLROnPlateau\n","kf = KFold(n_splits=N_SPLITS, shuffle=True, random_state=42)\n","fold_results = []\n","\n","print(\"\\n========== Starting Cross‚ÄëValidation ==========\\n\")\n","\n","for fold, (train_idx, val_idx) in enumerate(kf.split(dataset)):\n","    print(f\"\\n----- Fold {fold+1} -----\")\n","\n","    # free GPU memory from previous fold\n","    if device.type == 'cuda':\n","        torch.cuda.empty_cache()\n","\n","    # compute per-fold class weights\n","    train_labels = df.iloc[train_idx]['emotion'].values\n","    class_counts = np.bincount(train_labels)\n","    class_weights = 1.0 / class_counts\n","    sample_weights = class_weights[train_labels]\n","\n","    sampler = WeightedRandomSampler(\n","        weights=torch.DoubleTensor(sample_weights),\n","        num_samples=len(sample_weights),\n","        replacement=True\n","    )\n","\n","    # DataLoaders\n","    train_loader = DataLoader(\n","        Subset(dataset, train_idx),\n","        batch_size=BATCH_SIZE,\n","        sampler=sampler,\n","        num_workers=0,\n","        pin_memory=(device.type == 'cuda')\n","    )\n","\n","    val_loader = DataLoader(\n","        Subset(dataset, val_idx),\n","        batch_size=BATCH_SIZE,\n","        shuffle=False,\n","        num_workers=0,\n","        pin_memory=(device.type == 'cuda')\n","    )\n","\n","    # Model, optimizer, scheduler\n","    model = EEG_CNN().to(device)\n","    criterion = nn.CrossEntropyLoss()\n","    optimizer = optim.Adam(model.parameters(), lr=LEARNING_RATE, weight_decay=WEIGHT_DECAY)\n","    scheduler = ReduceLROnPlateau(optimizer, mode='min', factor=SCHED_FACTOR, patience=SCHED_PATIENCE, verbose=True)\n","\n","    # Train\n","    best_acc, best_state = train_with_early_stopping(\n","        model, train_loader, val_loader, criterion, optimizer, scheduler,\n","        max_epochs=MAX_EPOCHS, patience=PATIENCE, clip_grad=CLIP_GRAD\n","    )\n","\n","    if best_state is not None:\n","        model.load_state_dict(best_state)\n","\n","    fold_results.append(best_acc)\n","    print(f\"Best Accuracy (Fold {fold+1}): {best_acc:.2f}%\")\n","\n","# Final summary\n","print(\"\\n========== Final Cross‚ÄëValidation Results ==========\")\n","for i, acc in enumerate(fold_results):\n","    print(f\"Fold {i+1}: {acc:.2f}%\")\n","print(\"\\nAverage Accuracy =\", np.mean(fold_results))"]}],"metadata":{"kaggle":{"accelerator":"gpu","dataSources":[{"datasetId":218098,"sourceId":472319,"sourceType":"datasetVersion"}],"dockerImageVersionId":31193,"isGpuEnabled":true,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.13"},"papermill":{"default_parameters":{},"duration":32478.969353,"end_time":"2025-12-04T18:50:42.906426","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-12-04T09:49:23.937073","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}